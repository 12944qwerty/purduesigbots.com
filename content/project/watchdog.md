---
title: "Project Watchdog"
desc: "Monitor current consumption and detect motor stalls"
img: "/images/watchdog-data.png"
img_desc: "Graph of data collected from the watchdog sensor"
order: 2
---

## Overview
Project Watchdog represents an effort to monitor the dynamic power consumption of VEX Motors during testing an matches using a linear Hall-effect current sensor. It is designed to monitor motors to detect excessive load and to ensure motors do not stall out.

## Initial Design

The [ACS712 Hall-effect sensing chip](https://www.allegromicro.com/en/Products/Current-Sensor-ICs/Zero-To-Fifty-Amp-Integrated-Conductor-Sensor-ICs/ACS712.aspx) is a linear current sensor based on the Hall effect, measuring current using the magnetic field generated by current-carrying wires. The Watchdog board uses a custom PCB designed at Purdue by members of Purdue ACM SIGBots with four of these sensing ICs to measure the current draw of up to four motors at a time. the 5V analog output of each IC can be interfaced with the VEX Cortex Microcontroller or a [LeafLabs Maple](https://www.leaflabs.com/maple) and changes linearly from a 2.5V offset voltage in proportion to the current flow. Each sensor is bidirectional, but actual readings go only from 0A to 5A.

<iframe width="100%" height="461" src="https://www.youtube.com/embed/WLyXgygtGUg?start=0&end=20" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

### Features
- Completely isolated from the motor circuit under test, Watchdog is fully VEX competition-legal
- Isolated to 2000V from static electricity and transient voltages to protect delicate external processors
- Range from 0A to 5A (both DC and AC), handles all normal and stall currents of any current VEX Motor
- Interfaces in-line with VEX Motor Controllers, so few wiring changes are required for robots

### Drawbacks
- As the ACS712 is a 5V sensor, voltage translation to 3.3V analog levels is required
- Difficult to place and route wires in confined areas due to high wire density
- Resolution and line nose can be problematic (but are insignificant compared to the noise generated by the motors themselves)
- Not compatible with 2-wire motor ports (e.g. VEX Cortex ports 1 and 10)

## Updated Design

As some questions were raised surrounding the electrical isolation of the previous version of the Watchdog PCB, the project underwent a full redesign. The overarching goal of this redesign effort was to end up with dynamic power consumption monitoring capabilities that were unambiguously isolated from the motor control signals. To this end, the new board was built around the [LEM LSTR 6-NP Current Transducer](https://www.digikey.com/product-detail/en/lem-usa-inc/LTSR-6-NP/398-1021-5-ND/1026512) such that motor controller wires could pass through the sensor without going through the PCB itself. The board was also redesigned in such a way that it could be connected directly to a VEX Cortex Microcontroller, reducing the complexity of integrating the sensor into a robot. The final board functioned in much the same way as the previous iteration, and code was written to interpret raw analog values from the sensor and filter them.

<img src="../../images/watchdog_v2_detail.jpg" alt="Close up view of Project Watchdog PCB" style="width: 48%" />
<img src="../../images/watchdog_v2_wide.jpg" alt-"Wide shot of two Project Watchdog PCBs" style="width: 48%" />

### Improvements
- Sensing is -6A to 6A
- Unambiguously isolated from motor signals
- Designed to interface with the Cortex directly so no logic level shifting required
- No real wiring changes needed
- Easy to route wires because new design can sit on 3-wire extensions
- Noise is filtered
- Compatible with 2-wire ports

## Competition Usage

### VEX Sack Attack
Watchdog was first used on BLRS's two robots: Artemis and Daedalus. The sensor drove alerted drivers to overly aggressive behavior by scaling a [ShiftBrite RGB LED](https://www.sparkfun.com/products/10075) between red and green depending on real-time drive motor power draw. Driving too hard or becoming jammed on the sack game objects was enough to trip the integrated PTC resettable fuse built into the VEX motors.

### VEX Toss Up
Due to the difficulty of wiring Project Watchdog, the PCB was refactored into a shield that could be attached directly to a LeafLabs Maple. This shield also handled connections to the ShiftBrite LED modules. By replacing the prototyping shield used in prior years, there was no longer a need to route several analog signals in close proximity to motor wires or to use jumper wires for RGB LEDs. Otherwise, the connections and functionality remained identical to previous versions, and the device was used on both of BLRS's two robots: Atlas and Prometheus.

### VEX Starstruck
After some questions were raised concerning the electrical isolation of the motor wires from external influence with the previous redesign, Project Watchdog was redesigned again. During this season, BLRS used data collected from the sensor as feedback for the driver during practice, and the board was used in matches to provide real-time information to the driver about motor power consumption.

### VEX In The Zone
The redesign started during the Starstruck season reached completion with the fabrication and assembly of six PCBs. The sensors were again used in matches to provide real-time feedback to the drivers about motor power consumption levels.

## Future Development
Currently, Project Watchdog is based around providing information about motor power consumption while a robot is manually controlled. Work is ongoing to actually limit power sent to motors (in software) that are drawing too much current, which would make the sensors useful in autonomous routines as well. Possibilities range from using a PID controller to a more full-featured framework that performs current load-balancing by prioritizing which motors receive power in high-load situations.
